# LINEåˆ†å¸³æ©Ÿå™¨äºº v2.8.2 ğŸ¤–ğŸ’°

ä¸€å€‹å°ˆç‚ºLINEç¾¤çµ„è¨­è¨ˆçš„æ™ºæ…§åˆ†å¸³æ©Ÿå™¨äººï¼Œæä¾›å®Œæ•´çš„ç¾¤çµ„å…±åŒæ”¯å‡ºç®¡ç†åŠŸèƒ½ã€‚

## âœ¨ ç‰ˆæœ¬ç‰¹è‰² (v2.8.2)

### ğŸ¯ ç´”ç²¹çš„ç¾¤çµ„åˆ†å¸³è¨ˆç®—é‚è¼¯

- å°ˆæ³¨æ–¼ç¾¤çµ„æˆå“¡é–“çš„å‚µå‹™è¨ˆç®—
- ä»˜æ¬¾äººè‡ªå‹•åƒèˆ‡åˆ†æ”¤ä½†ä¸æœƒæ¬ è‡ªå·±éŒ¢
- ç§»é™¤@è‡ªå·±ç›¸é—œçš„å¤šé¤˜ç¨‹å¼ç¢¼ï¼ˆLINEä¸æ”¯æ´@è‡ªå·±ï¼‰
- ç°¡æ½”ç›´è§€çš„åˆ†å¸³æµç¨‹

### ğŸ’° å…¨é¢çµç®—åŠŸèƒ½

- ğŸ”¥ **NEW** ä¸€éµæ™ºæ…§çµç®—æ‰€æœ‰å¸³å–®
- è‡ªå‹•å°å­˜å·²çµæ¸…çš„å¸³å–®
- å®Œæ•´çš„çµç®—å ±å‘Š
- ç¢ºä¿è³‡æ–™åº«ç‹€æ…‹ä¸€è‡´æ€§

### ğŸ›¡ï¸ å¼·åŒ–çš„å®‰å…¨æ€§

- å®Œå–„çš„é‡è¤‡æ“ä½œé˜²è­·æ©Ÿåˆ¶
- å…§å®¹hashé˜²æ­¢é‡è¤‡å»ºç«‹ç›¸åŒå¸³å–®
- å¼·åŒ–çš„ç¾¤çµ„è³‡æ–™éš”é›¢
- å®Œæ•´çš„è³‡æ–™åº«å®Œæ•´æ€§ä¿è­·

### ğŸ¨ ç¾ä»£åŒ–ç”¨æˆ¶ç•Œé¢

- ç¾è§€çš„Flex Messageå¡ç‰‡å¼ç•Œé¢
- ç›´è§€çš„æ“ä½œæµç¨‹
- å®Œæ•´çš„æŒ‡ä»¤å¹«åŠ©ç³»çµ±

## ğŸš€ æ ¸å¿ƒåŠŸèƒ½

### 1. ğŸ’³ æ™ºæ…§åˆ†å¸³è¨ˆç®—

- **å‡æ”¤æ¨¡å¼**ï¼šæ‰€æœ‰äººå¹³å‡åˆ†æ”¤è²»ç”¨
- **åˆ†åˆ¥è¨ˆç®—æ¨¡å¼**ï¼šæ¯äººè² æ“”ä¸åŒé‡‘é¡
- ä»˜æ¬¾äººè‡ªå‹•åƒèˆ‡åˆ†æ”¤è¨ˆç®—
- ç²¾ç¢ºçš„å°æ•¸é»è™•ç†

### 2. ğŸ“Š å¸³å–®ç®¡ç†

- å»ºç«‹å’Œç®¡ç†ç¾¤çµ„å¸³å–®
- æŸ¥çœ‹å¸³å–®è©³æƒ…å’Œåƒèˆ‡äººç‹€æ…‹
- å¸³å–®åˆ—è¡¨å’Œç‹€æ…‹è¿½è¹¤
- è‡ªå‹•å°å­˜å·²çµæ¸…å¸³å–®

### 3. ğŸ’¸ å‚µå‹™è¿½è¹¤

- å€‹äººæ¬ æ¬¾æŸ¥è©¢
- ä»˜æ¬¾ç‹€æ…‹æ›´æ–°
- çµå¸³è¨˜éŒ„è¿½è¹¤

### 4. ğŸ”’ ç¾¤çµ„éš”é›¢

- å®Œç¾çš„å¤šç¾¤çµ„è³‡æ–™éš”é›¢
- åŒä¸€ç”¨æˆ¶å¯åœ¨å¤šå€‹ç¾¤çµ„ä¸­ä½¿ç”¨
- ç¾¤çµ„å°ˆå±¬çš„æˆå“¡å’Œå¸³å–®ç®¡ç†

### 5. ğŸ›¡ï¸ é‡è¤‡æ“ä½œé˜²è­·

- æ™ºæ…§é‡è¤‡æ“ä½œæª¢æ¸¬
- å…§å®¹hashé˜²é‡è¤‡å»ºç«‹
- è‡ªå‹•æ¸…ç†éæœŸè¨˜éŒ„

## ğŸ“± ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬æŒ‡ä»¤

#### ğŸ†• æ–°å¢æ”¯å‡º

```text
# å‡æ”¤æ¨¡å¼ - æ‰€æœ‰äººå¹³å‡åˆ†æ”¤
#æ–°å¢æ”¯å‡º 300 åˆé¤ @å°ç¾ @å°ç‹
# çµæœï¼šæ‚¨å’Œ2ä½æœ‹å‹å‡æ”¤ï¼Œæ¯äºº100å…ƒ

# åˆ†åˆ¥è¨ˆç®—æ¨¡å¼ - æ¯äººä¸åŒé‡‘é¡
#æ–°å¢æ”¯å‡º 1000 èšé¤ @å°ç¾ 400 @å°ç‹ 350
# çµæœï¼šæ‚¨è² æ“”å‰©é¤˜250å…ƒï¼Œå°ç¾400å…ƒï¼Œå°ç‹350å…ƒ
```

#### ğŸ“‹ æŸ¥çœ‹åŠŸèƒ½

```text
#å¸³å–®åˆ—è¡¨          # æŸ¥çœ‹æ‰€æœ‰å¸³å–®
#æ”¯å‡ºè©³æƒ… B-ID     # æŸ¥çœ‹ç‰¹å®šå¸³å–®è©³æƒ…
#æˆ‘çš„æ¬ æ¬¾          # æŸ¥çœ‹å€‹äººæœªä»˜æ¬¾é …
```

#### ğŸ’° çµç®—åŠŸèƒ½

```text
#çµå¸³ B-ID @å·²ä»˜æˆå“¡1 @æˆå“¡2...  # æ¨™è¨˜å€‹åˆ¥ä»˜æ¬¾
#å…¨é¢çµç®—                        # ğŸ”¥ æ™ºæ…§çµç®—æ‰€æœ‰å¸³å–®
#å°å­˜å¸³å–® B-ID                   # æ‰‹å‹•å°å­˜å¸³å–®
```

#### ğŸ¨ è¦–è¦ºåŒ–é¸å–®

```text
#é¸å–®              # ä¸»é¸å–®
#å»ºç«‹å¸³å–®          # å¸³å–®å»ºç«‹ç²¾éˆ
#å¹«åŠ©              # ä½¿ç”¨èªªæ˜
```

### ä½¿ç”¨ç¯„ä¾‹

#### æƒ…å¢ƒ1ï¼šæœ‹å‹èšé¤å‡æ”¤

```text
ç”¨æˆ¶ï¼š#æ–°å¢æ”¯å‡º 600 èšé¤ @å°ç¾ @å°ç‹ @å°æ
æ©Ÿå™¨äººï¼šâœ… æ–°å¢æ”¯å‡º B-1ï¼
       åç›®: èšé¤
       ä»˜æ¬¾äºº: @æ‚¨ (æ‚¨)
       ç¸½æ”¯å‡º: 600.00
       é¡å‹: å‡æ”¤
       æ‚¨çš„åˆ†æ”¤: 150.00
       æ‚¨å¯¦ä»˜: 600.00
       æ‡‰æ”¶å›: 450.00
       æ˜ç´° (3äººæ¬ æ¬¾):
       @å°ç¾ æ‡‰ä»˜ 150.00
       @å°ç‹ æ‡‰ä»˜ 150.00
       @å°æ æ‡‰ä»˜ 150.00
```

#### æƒ…å¢ƒ2ï¼šå„è‡ªé»é¤ä¸åŒåƒ¹æ ¼

```text
ç”¨æˆ¶ï¼š#æ–°å¢æ”¯å‡º 1200 èšé¤ @å°ç¾ 350 @å°ç‹ 280 @å°æ 320
æ©Ÿå™¨äººï¼šâœ… æ–°å¢æ”¯å‡º B-2ï¼
       åç›®: èšé¤
       ä»˜æ¬¾äºº: @æ‚¨ (æ‚¨)
       ç¸½æ”¯å‡º: 1200.00
       é¡å‹: åˆ†åˆ¥è¨ˆç®—
       æ‚¨çš„åˆ†æ”¤: 250.00
       æ‚¨å¯¦ä»˜: 1200.00
       æ‡‰æ”¶å›: 950.00
       æ˜ç´° (3äººæ¬ æ¬¾):
       @å°ç¾ æ‡‰ä»˜ 350.00
       @å°ç‹ æ‡‰ä»˜ 280.00
       @å°æ æ‡‰ä»˜ 320.00
```

#### æƒ…å¢ƒ3ï¼šå…¨é¢çµç®—

```text
ç”¨æˆ¶ï¼š#å…¨é¢çµç®—
æ©Ÿå™¨äººï¼š--- ğŸ’° @æ‚¨ å…¨é¢çµç®—å ±å‘Š ---

       ğŸ“Š çµ±è¨ˆæ‘˜è¦:
       â€¢ ç¸½å¸³å–®æ•¸: 5 ç­†
       â€¢ å·²çµæ¸…: 3 ç­†
       â€¢ éƒ¨åˆ†ä»˜æ¬¾: 1 ç­†
       â€¢ å®Œå…¨æœªä»˜: 1 ç­†
       â€¢ è‡ªå‹•å°å­˜: 3 ç­†

       ğŸ’µ é‡‘é¡æ‘˜è¦:
       â€¢ æ”¯å‡ºç¸½é¡: 2500.00
       â€¢ å·²æ”¶å›: 1800.00
       â€¢ å¾…æ”¶å›: 700.00

       âœ¨ çµç®—å®Œæˆï¼å·²è‡ªå‹•å°å­˜ 3 ç­†çµæ¸…å¸³å–®ã€‚
```

## ğŸ”§ æŠ€è¡“æ¶æ§‹

### ç³»çµ±æ¶æ§‹

- **å¾Œç«¯æ¡†æ¶**ï¼šFlask + SQLAlchemy
- **è³‡æ–™åº«**ï¼šPostgreSQL (æ”¯æ´SQLiteé–‹ç™¼)
- **LINE SDK**ï¼šline-bot-sdk
- **éƒ¨ç½²æ–¹å¼**ï¼šDocker + Heroku/Railway

### è³‡æ–™åº«è¨­è¨ˆ

```sql
-- ç¾¤çµ„æˆå“¡è¡¨
sb_group_members (
    id, name, group_id, line_user_id, 
    created_at, updated_at
)

-- å¸³å–®è¡¨
sb_bills (
    id, group_id, description, total_bill_amount,
    payer_member_id, split_type, content_hash,
    is_archived, created_at, updated_at
)

-- å¸³å–®åƒèˆ‡äººè¡¨
sb_bill_participants (
    id, bill_id, debtor_member_id, amount_owed,
    is_paid, paid_at, created_at, updated_at
)

-- é‡è¤‡æ“ä½œé˜²è­·è¡¨
sb_duplicate_prevention_log (
    id, operation_hash, group_id, user_id,
    operation_type, created_at
)
```

### æ ¸å¿ƒç‰¹æ€§

1. **ç¾¤çµ„éš”é›¢**ï¼šè¤‡åˆå”¯ä¸€ç´„æŸç¢ºä¿è³‡æ–™éš”é›¢
2. **é‡è¤‡é˜²è­·**ï¼šHashæ©Ÿåˆ¶é˜²æ­¢é‡è¤‡æ“ä½œ
3. **è³‡æ–™å®Œæ•´æ€§**ï¼šå¤–éµç´„æŸå’Œç´šè¯åˆªé™¤
4. **æ•ˆèƒ½å„ªåŒ–**ï¼šè¤‡åˆç´¢å¼•æå‡æŸ¥è©¢æ•ˆèƒ½

## ğŸ› ï¸ å®‰è£èˆ‡éƒ¨ç½²

### ç’°å¢ƒéœ€æ±‚

- Python 3.8+
- PostgreSQL 12+
- LINE Bot Channel

### æœ¬åœ°é–‹ç™¼

1. **å…‹éš†å°ˆæ¡ˆ**

   ```bash
   git clone https://github.com/yourusername/line-split-bot.git
   cd line-split-bot
   ```

2. **å®‰è£ä¾è³´**

   ```bash
   pip install -r requirements.txt
   # æˆ–ä½¿ç”¨ Poetry
   poetry install
   ```

3. **ç’°å¢ƒè¨­å®š**

   ```bash
   # å‰µå»º .env æª”æ¡ˆ
   LINE_CHANNEL_ACCESS_TOKEN=your_channel_access_token
   LINE_CHANNEL_SECRET=your_channel_secret
   DATABASE_URL_SPLITBILL=postgresql://user:password@localhost/splitbill_db
   ```

4. **åˆå§‹åŒ–è³‡æ–™åº«**

   ```bash
   python -c "from models_splitbill import init_db_splitbill; init_db_splitbill()"
   ```

5. **å•Ÿå‹•æœå‹™**

   ```bash
   python app_splitbill.py
   ```

### ç”Ÿç”¢ç’°å¢ƒéƒ¨ç½²

1. **ä½¿ç”¨ Heroku**

   ```bash
   heroku create your-app-name
   heroku addons:create heroku-postgresql:hobby-dev
   heroku config:set LINE_CHANNEL_ACCESS_TOKEN=your_token
   heroku config:set LINE_CHANNEL_SECRET=your_secret
   git push heroku main
   ```

2. **ä½¿ç”¨ Railway**

   ```bash
   railway login
   railway new
   railway add postgresql
   railway deploy
   ```

### LINE Bot è¨­å®š

1. åœ¨ [LINE Developers Console](https://developers.line.biz/) å»ºç«‹æ–°çš„ Provider å’Œ Channel
2. å–å¾— Channel Access Token å’Œ Channel Secret
3. è¨­å®š Webhook URLï¼š`https://your-domain.com/splitbill/callback`
4. å•Ÿç”¨ Webhook æ¥æ”¶è¨Šæ¯

## ğŸ§ª æ¸¬è©¦

### åŸ·è¡Œå®Œæ•´æ¸¬è©¦å¥—ä»¶

```bash
python test_complete_v282.py
```

### æ¸¬è©¦è¦†è“‹ç¯„åœ

- âœ… è³‡æ–™åº«çµæ§‹æ¸¬è©¦
- âœ… ç¾¤çµ„éš”é›¢åŠŸèƒ½
- âœ… é‡è¤‡æ“ä½œé˜²è­·
- âœ… å‡æ”¤è¨ˆç®—é‚è¼¯
- âœ… åˆ†åˆ¥è¨ˆç®—é‚è¼¯
- âœ… å¸³å–®å»ºç«‹å’ŒæŸ¥è©¢
- âœ… æ¬ æ¬¾è¿½è¹¤
- âœ… ä»˜æ¬¾çµç®—
- âœ… å¸³å–®å°å­˜
- âœ… å…§å®¹hashé˜²è­·
- âœ… èˆŠè¨˜éŒ„æ¸…ç†

## ğŸ“š API æ–‡æª”

### ä¸»è¦ç«¯é»

- `POST /splitbill/callback` - LINE Webhook æ¥æ”¶ç«¯é»

### æ ¸å¿ƒåŠŸèƒ½å‡½æ•¸

```python
# åˆ†å¸³è¨ˆç®—
parse_participant_input_v282(participants_str, total_amount, payer_name)

# å¸³å–®ç®¡ç†
handle_add_bill_v280(reply_token, match, group_id, sender_line_user_id, sender_mention_name, db)
handle_list_bills_v280(reply_token, group_id, sender_line_user_id, db)
handle_bill_details_v280(reply_token, bill_db_id, group_id, sender_line_user_id, db)

# çµç®—åŠŸèƒ½
handle_settle_payment_v280(reply_token, bill_db_id, debtor_mentions_str, group_id, sender_line_user_id, db)
handle_complete_settlement_v282(reply_token, group_id, sender_line_user_id, db)
handle_archive_bill_v280(reply_token, bill_db_id, group_id, sender_line_user_id, db)
```

## ğŸ” å¸¸è¦‹å•é¡Œ FAQ

### Q: ç‚ºä»€éº¼ä¸èƒ½@è‡ªå·±ï¼Ÿ

A: LINEå¹³å°ä¸æ”¯æ´@è‡ªå·±çš„åŠŸèƒ½ï¼Œä½†ä»˜æ¬¾äººæœƒè‡ªå‹•åƒèˆ‡åˆ†æ”¤è¨ˆç®—ï¼Œç„¡éœ€@è‡ªå·±ã€‚

### Q: å¦‚ä½•è™•ç†å°æ•¸é»å•é¡Œï¼Ÿ

A: ç³»çµ±ä½¿ç”¨Decimalç²¾ç¢ºè¨ˆç®—ï¼Œå°¾æ•¸å·®é¡ç”±ä»˜æ¬¾äººæ‰¿æ“”ã€‚

### Q: è³‡æ–™æœƒåœ¨ä¸åŒç¾¤çµ„é–“æ··æ·†å—ï¼Ÿ

A: ä¸æœƒã€‚ç³»çµ±æœ‰å®Œå–„çš„ç¾¤çµ„éš”é›¢æ©Ÿåˆ¶ï¼Œç¢ºä¿è³‡æ–™å®‰å…¨ã€‚

### Q: é‡è¤‡æ“ä½œå¦‚ä½•é˜²è­·ï¼Ÿ

A: ç³»çµ±ä½¿ç”¨é›™é‡é˜²è­·ï¼šæ“ä½œhashé˜²é‡è¤‡å‹•ä½œï¼Œå…§å®¹hashé˜²é‡è¤‡å»ºç«‹ã€‚

### Q: å¦‚ä½•æ¸…ç†èˆŠè³‡æ–™ï¼Ÿ

A: ä½¿ç”¨`#å…¨é¢çµç®—`è‡ªå‹•å°å­˜å·²çµæ¸…å¸³å–®ï¼Œç³»çµ±æœƒè‡ªå‹•æ¸…ç†èˆŠçš„é˜²è­·è¨˜éŒ„ã€‚

## ğŸ¯ ç‰ˆæœ¬æ›´æ–°æ­·ç¨‹

### v2.8.2 (Latest)

- ğŸ”¥ æ–°å¢å…¨é¢çµç®—åŠŸèƒ½
- ğŸ¯ ç´”ç²¹çš„ç¾¤çµ„åˆ†å¸³è¨ˆç®—é‚è¼¯
- ğŸš« ç§»é™¤@è‡ªå·±ç›¸é—œçš„å¤šé¤˜ç¨‹å¼ç¢¼
- ğŸ›¡ï¸ å¼·åŒ–è³‡æ–™åº«å®Œæ•´æ€§å’Œä¸€è‡´æ€§

### v2.8.1

- ğŸ§® é‡æ–°è¨­è¨ˆåˆ†æ”¤é‚è¼¯
- ğŸ¨ æ–°å¢Flex Messageç•Œé¢
- âœ¨ ä»˜æ¬¾äººé è¨­åƒèˆ‡åˆ†æ”¤
- ğŸ”§ å„ªåŒ–ç”¨æˆ¶é«”é©—

### v2.8.0

- ğŸ›¡ï¸ é‡è¤‡æ“ä½œé˜²è­·æ©Ÿåˆ¶
- ğŸ  ç¾¤çµ„éš”é›¢å¼·åŒ–
- ğŸ“Š è³‡æ–™åº«çµæ§‹é‡æ–°è¨­è¨ˆ
- ğŸ”’ å…§å®¹hashé˜²é‡è¤‡å»ºç«‹

## ğŸ¤ è²¢ç»æŒ‡å—

æ­¡è¿æäº¤ Issue å’Œ Pull Requestï¼

### é–‹ç™¼æµç¨‹

1. Fork æœ¬å°ˆæ¡ˆ
2. å‰µå»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. é–‹å•Ÿ Pull Request

### ä»£ç¢¼é¢¨æ ¼

- ä½¿ç”¨ Black æ ¼å¼åŒ–ä»£ç¢¼
- éµå¾ª PEP 8 è¦ç¯„
- æ·»åŠ é©ç•¶çš„é¡å‹è¨»è§£
- ç·¨å¯«å®Œæ•´çš„æ¸¬è©¦

## ğŸ“„ æˆæ¬Šæ¢æ¬¾

æœ¬å°ˆæ¡ˆæ¡ç”¨ MIT æˆæ¬Šæ¢æ¬¾ - æŸ¥çœ‹ [LICENSE](LICENSE) æª”æ¡ˆäº†è§£è©³æƒ…ã€‚

## ğŸ™ è‡´è¬

æ„Ÿè¬æ‰€æœ‰ç‚ºæœ¬å°ˆæ¡ˆåšå‡ºè²¢ç»çš„é–‹ç™¼è€…å’Œä½¿ç”¨è€…ï¼

---
